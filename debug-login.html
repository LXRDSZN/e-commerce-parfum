<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - Élite Perfumería</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="card">
            <div class="card-header">
                <h4>Debug del Sistema de Login</h4>
            </div>
            <div class="card-body">
                <div id="debug-info"></div>
                
                <hr>
                
                <h5>Test Login Cliente</h5>
                <button class="btn btn-primary" onclick="testLogin()">
                    Test Login Cliente
                </button>
                
                <button class="btn btn-danger ms-2" onclick="testLoginAdmin()">
                    Test Login Admin
                </button>
                
                <button class="btn btn-secondary ms-2" onclick="checkCurrentUser()">
                    Ver Usuario Actual
                </button>
                
                <button class="btn btn-warning ms-2" onclick="clearAll()">
                    Limpiar Todo
                </button>
                
                <hr>
                
                <div class="user-menu border p-3 mt-3">
                    <h6>Menu de Usuario (se actualiza automáticamente):</h6>
                    <!-- Este se actualiza automáticamente -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        function updateDebugInfo(info) {
            document.getElementById('debug-info').innerHTML = `
                <div class="alert alert-info">
                    <pre>${JSON.stringify(info, null, 2)}</pre>
                </div>
            `;
        }

        function testLogin() {
            console.log('Testing cliente login...');
            
            const authResult = authSystem.authenticate('cliente@email.com', 'cliente123');
            console.log('Auth result:', authResult);
            
            if (authResult.success) {
                const loginResult = authSystem.login(authResult.user, false);
                console.log('Login result:', loginResult);
                console.log('Current user after login:', authSystem.getCurrentUser());
                
                updateDebugInfo({
                    message: 'Login exitoso',
                    authResult: authResult,
                    currentUser: authSystem.getCurrentUser(),
                    isLoggedIn: authSystem.isLoggedIn()
                });
            } else {
                updateDebugInfo({
                    message: 'Login falló',
                    error: authResult.error
                });
            }
        }

        function testLoginAdmin() {
            console.log('Testing admin login...');
            
            const authResult = authSystem.authenticate('admin@eliteperfumeria.com', 'admin123');
            console.log('Auth result:', authResult);
            
            if (authResult.success) {
                const loginResult = authSystem.login(authResult.user, false);
                console.log('Login result:', loginResult);
                console.log('Current user after login:', authSystem.getCurrentUser());
                
                updateDebugInfo({
                    message: 'Login Admin exitoso',
                    authResult: authResult,
                    currentUser: authSystem.getCurrentUser(),
                    isLoggedIn: authSystem.isLoggedIn()
                });
            } else {
                updateDebugInfo({
                    message: 'Login Admin falló',
                    error: authResult.error
                });
            }
        }

        function checkCurrentUser() {
            const currentUser = authSystem.getCurrentUser();
            const isLoggedIn = authSystem.isLoggedIn();
            
            console.log('Current user check:', {
                currentUser,
                isLoggedIn,
                localStorage: localStorage.getItem('currentUser'),
                sessionStorage: sessionStorage.getItem('currentUser')
            });
            
            updateDebugInfo({
                message: 'Estado actual',
                currentUser: currentUser,
                isLoggedIn: isLoggedIn,
                localStorage_data: localStorage.getItem('currentUser'),
                sessionStorage_data: sessionStorage.getItem('currentUser')
            });
        }

        function clearAll() {
            authSystem.logout();
            localStorage.clear();
            sessionStorage.clear();
            updateDebugInfo({ message: 'Todo limpiado' });
            location.reload();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, authSystem:', authSystem);
            checkCurrentUser();
        });
    </script>
</body>
</html>