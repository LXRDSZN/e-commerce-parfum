<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Login - Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4>Test Login Fix</h4>
                        
                        <div class="alert alert-info">
                            <strong>Cuentas de prueba:</strong><br>
                            Cliente: cliente@email.com / cliente123<br>
                            Admin: admin@eliteperfumeria.com / admin123
                        </div>
                        
                        <form id="quickLogin">
                            <div class="mb-3">
                                <input type="email" class="form-control" id="email" placeholder="Email">
                            </div>
                            <div class="mb-3">
                                <input type="password" class="form-control" id="password" placeholder="Password">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Login</button>
                        </form>
                        
                        <hr>
                        
                        <div class="user-menu border p-3">
                            <div id="userDisplay">No hay usuario logueado</div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-success btn-sm" onclick="testClienteLogin()">Login Cliente</button>
                            <button class="btn btn-danger btn-sm" onclick="testAdminLogin()">Login Admin</button>
                            <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
                        </div>
                        
                        <div class="mt-3">
                            <pre id="debugInfo" class="text-muted small"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simplified auth system for testing
        const testAuth = {
            currentUser: null,
            
            authenticate(email, password) {
                const users = {
                    'cliente@email.com': {
                        email: 'cliente@email.com',
                        password: 'cliente123',
                        nombre: 'Cliente',
                        apellido: 'Prueba',
                        role: 'customer'
                    },
                    'admin@eliteperfumeria.com': {
                        email: 'admin@eliteperfumeria.com', 
                        password: 'admin123',
                        nombre: 'Administrador',
                        apellido: 'Sistema',
                        role: 'admin'
                    }
                };
                
                const user = users[email];
                if (user && user.password === password) {
                    return {
                        success: true,
                        user: {
                            id: Date.now(),
                            nombre: user.nombre,
                            apellido: user.apellido,
                            email: user.email,
                            role: user.role,
                            loginTime: new Date().toISOString()
                        }
                    };
                }
                
                return { success: false, error: 'Credenciales incorrectas' };
            },
            
            login(userData) {
                this.currentUser = userData;
                sessionStorage.setItem('currentUser', JSON.stringify(userData));
                this.updateUI();
                return true;
            },
            
            logout() {
                this.currentUser = null;
                sessionStorage.removeItem('currentUser');
                localStorage.removeItem('currentUser');
                this.updateUI();
            },
            
            getCurrentUser() {
                if (!this.currentUser) {
                    const stored = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
                    if (stored) {
                        this.currentUser = JSON.parse(stored);
                    }
                }
                return this.currentUser;
            },
            
            isLoggedIn() {
                return this.getCurrentUser() !== null;
            },
            
            updateUI() {
                const userDisplay = document.getElementById('userDisplay');
                const debugInfo = document.getElementById('debugInfo');
                
                if (this.isLoggedIn()) {
                    const user = this.getCurrentUser();
                    const fullName = `${user.nombre || 'Sin nombre'} ${user.apellido || ''}`.trim();
                    
                    userDisplay.innerHTML = `
                        <strong>Usuario logueado:</strong><br>
                        Nombre: ${fullName}<br>
                        Email: ${user.email}<br>
                        Rol: ${user.role}<br>
                        Login: ${new Date(user.loginTime).toLocaleString()}
                    `;
                    
                    debugInfo.textContent = JSON.stringify(user, null, 2);
                } else {
                    userDisplay.innerHTML = '<em>No hay usuario logueado</em>';
                    debugInfo.textContent = 'No user data';
                }
            }
        };

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            testAuth.updateUI();
            
            document.getElementById('quickLogin').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const result = testAuth.authenticate(email, password);
                
                if (result.success) {
                    testAuth.login(result.user);
                    alert('Â¡Login exitoso!');
                } else {
                    alert('Error: ' + result.error);
                }
            });
        });

        function testClienteLogin() {
            const result = testAuth.authenticate('cliente@email.com', 'cliente123');
            if (result.success) {
                testAuth.login(result.user);
                alert('Login cliente exitoso!');
            }
        }

        function testAdminLogin() {
            const result = testAuth.authenticate('admin@eliteperfumeria.com', 'admin123');
            if (result.success) {
                testAuth.login(result.user);
                alert('Login admin exitoso!');
            }
        }

        function logout() {
            testAuth.logout();
            alert('Logout exitoso');
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }
    </script>
</body>
</html>